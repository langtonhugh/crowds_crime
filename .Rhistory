# plot
ggplot(data = la_safe_sf) +
geom_histogram(mapping = aes(x = total_ppl))
# remove outliers (e.g. airport)
la_safe_sub_sf <- la_safe_sf %>%
filter(total_pp < 10000)
# remove outliers (e.g. airport)
la_safe_sub_sf <- la_safe_sf %>%
filter(total_ppl < 10000)
ggplot(data = la_safe_sub_sf) +
geom_histogram(mapping = aes(x = total_ppl))
ggplot(data = la_safe_sub_sf) +
geom_histogram(mapping = aes(x = total_ppl), bins = 60)
# remove outliers (e.g. airport)
la_safe_sub_sf <- la_safe_sf %>%
filter(total_ppl <2500)
ggplot(data = la_safe_sub_sf) +
geom_histogram(mapping = aes(x = total_ppl), bins = 60)
# remove outliers (e.g. airport)
la_safe_sub_sf <- la_safe_sf %>%
filter(total_ppl < 3000)
ggplot(data = la_safe_sub_sf) +
geom_histogram(mapping = aes(x = total_ppl), bins = 60)
# map
ggplot(data = la_safe_sub_sf) +
geom_sf(mapping = aes(fill = total_ppl), colour = "transparent")
# map
ggplot(data = la_safe_sub_sf) +
geom_sf(mapping = aes(fill = total_ppl), colour = "transparent")
# keep hourly counts
la_long_df <- cali_sub_long_df %>%
filter(GEOID %in% la_census_vec) %>%
rename(area = GEOID)
# keep hourly counts
la_long_df <- cali_sub_long_df %>%
filter(area %in% la_census_vec)
View(la_long_df)
# keep hourly counts
la_long_df <- cali_sub_df %>%
filter(area %in% la_census_vec)
View(la_long_df)
# join
la_safe_daily_sf <- left_join(la_sf, la_long_df)
View(la_safe_daily_sf)
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(1)
plot(st_geometry(la_safe_sf))
plot(st_geometry(airport_sf))
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2)
plot(st_geometry(airport_sf))
View(airport_sf)
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) %>% # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
pluck(area)
library(purrr)
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) %>% # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
pluck(area)
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2)
names(airport_sf)
la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2)
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) %>% # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
pluck(area)
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) %>% # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
select(area)
airport_sf
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) %>% # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
select(area[[1]])
?pluck
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) %>% # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
purrr::pluck(area)
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2)
names(airport_sf)
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
airport_sf$area
airport_code <- airport_sf$area
View(la_long_df)
names(la_long_df)
# plot airport
la_long_df %>%
filter(area == airport_code)
# plot airport
la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
# plot airport
la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
ggplot() +
geom_line(mapping = aes(x = name, y = value, group = 1))
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(airport_plot_df$name, "t", ""))
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""))
View(airport_plot_df)
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
View(airport_plot_df)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""))
View(airport_plot_df)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name))
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name)) %>%
ggplot() +  geom_line(mapping = aes(x = name, y = value, group = 1))
ggplot(data = airport_plot_df) +
geom_line(mapping = aes(x = name, y = value, group = 1))
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name))
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name))
class(airport_plot_df)
ggplot(data = airport_plot_df) +
geom_line(mapping = aes(x = name, y = value, group = 1))
library(tidycensus)
library(readr)
library(dplyr)
library(tidyr)
library(sf)
library(ggplot2)
library(purrr)
# safe_df <- read_csv("data/neighborhood_patterns_june_2020.gz")
# cali_df <- safe_df %>%
#   filter(region == "CA")
# write_csv(x = cali_df, path = "data/cali_nhood_safegraph.csv")
# safegraph nhood data subset for california.
cali_df <- read_csv("data/cali_nhood_safegraph.csv")
# clean and grab hourly counts for a Monday.
cali_sub_df <- cali_df %>%
select(area, popularity_by_hour_monday) %>%
separate(col = popularity_by_hour_monday, sep = ",", into = paste0("t", 1:24))
cali_sub_df <- cali_sub_df %>%
mutate(t1 = gsub(x = cali_sub_df$t1, pattern = "\\[", replacement = ""),
t24 = gsub(x = cali_sub_df$t24, pattern = "\\]", replacement = ""))
# transform and aggregate for test.
cali_sub_long_df <- cali_sub_df %>%
pivot_longer(cols = -area, names_to = "time", values_to = "ppl") %>%
mutate(ppl = as.numeric(ppl)) %>%
group_by(area) %>%
summarise(total_ppl = sum(ppl))
# read in census block shapefile
cali_sf <- st_read("data/tl_2016_06_bg.shp")
# la census blocks
la_df <- read_csv("data/Monthly_Dockless_Vehicles_Trip_Start_By_Census_Block_Group.csv")
la_census_vec <- la_df$geography_key
# subset
la_sf <- cali_sf %>%
filter(GEOID %in% la_census_vec) %>%
rename(area = GEOID)
# plot
# ggplot(data = la_sf) +
#   geom_sf()
# join
la_safe_sf <- left_join(la_sf, cali_sub_long_df)
# plot
ggplot(data = la_safe_sf) +
geom_histogram(mapping = aes(x = total_ppl))
# map
ggplot(data = la_safe_sf) +
geom_sf(mapping = aes(fill = total_ppl), colour = "transparent")
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(1) # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
airport_code <- airport_sf$area
# keep hourly counts
la_long_df <- cali_sub_df %>%
filter(area %in% la_census_vec)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name))
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name))
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area) %>%
mutate(name = gsub(x = la_long_df$name, pattern = "t", replacement = ""),
name = as.numeric(name))
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
airport_plot_df %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name)) %>%
ggplot() +
geom_line(mapping = aes(x = name, y = value, group = 1))
# airport case study
airport_sf <- la_safe_sf %>%
arrange(desc(total_ppl)) %>%
slice(2) # trial and error matched to map shape... soz. plot(st_geometry(airport_sf))
airport_code <- airport_sf$area
# keep hourly counts
la_long_df <- cali_sub_df %>%
filter(area %in% la_census_vec)
# plot airport
airport_plot_df <- la_long_df %>%
filter(area == airport_code) %>%
pivot_longer(cols = -area)
airport_plot_df %>%
mutate(name = gsub(x = airport_plot_df$name, pattern = "t", replacement = ""),
name = as.numeric(name)) %>%
ggplot() +
geom_line(mapping = aes(x = name, y = value, group = 1))
class(la_safe_sf$total_ppl)
class(airport_plot_df$value)
class(airport_plot_df$name)
library(tidycensus)
library(readr)
library(dplyr)
library(tidyr)
library(sf)
library(ggplot2)
library(purrr)
# safe_df <- read_csv("data/neighborhood_patterns_june_2020.gz")
# cali_df <- safe_df %>%
#   filter(region == "CA")
# write_csv(x = cali_df, path = "data/cali_nhood_safegraph.csv")
# safegraph nhood data subset for california.
cali_df <- read_csv("data/cali_nhood_safegraph.csv")
# clean and grab hourly counts for a Monday.
cali_sub_df <- cali_df %>%
select(area, popularity_by_hour_monday) %>%
separate(col = popularity_by_hour_monday, sep = ",", into = paste0("t", 1:24))
View(cali_sub_df)
View(cali_df)
length(unique(cali_df$area))
names(cali_df)
# grab the variables that are most interesting.
cali_sub_df <- cali_df %>%
select(area, raw_stop_counts, raw_device_counts, stops_by_day, stops_by_each_hour,
popularity_by_hour_monday  , popularity_by_hour_tuesday, popularity_by_hour_wednesday
popularity_by_hour_thursday, popularity_by_hour_friday , popularity_by_hour_saturday,
popularity_by_hour_sunday)
cali_df %>% select(stops_by_each_hour) %>% slice(1)
cali_df %>% select(stops_by_each_hour) %>% slice(1) %>% pluck()
test <- cali_df %>% select(stops_by_each_hour) %>% slice(1) %>% pluck()
length(test)
length(test$stops_by_each_hour)
tesat
test
test[[1]]
length(test[[1]])
dim(test[[1]])
nrow(test[[1]])
test <- cali_df %>% select(stops_by_each_hour) %>% slice(1) %>% pluck()
test[[1]]
gsub(test[[1]], pattern = "\\[", replacement = "")
test2 <- gsub(test[[1]], pattern = "\\[", replacement = "")
test3 <- gsub(test[[1]], pattern = "\\]", replacement = "")
test3
test <- cali_df %>% select(stops_by_each_hour) %>% slice(1) %>% pluck()
test2 <- gsub(test[[1]], pattern = "\\[", replacement = "")
test3 <- gsub(test2[[1]], pattern = "\\]", replacement = "")
test3
as.numeric(test3)
class(test3)
as.list(test3)
test3[[1]]
as.numeric(test3[[1]])
as.list(test3)
lapply(as.list(test3), as.numeric)
30*24
num <- c(1,0,0,0,0,0,0,0,1,1,0,0,0,1,2,1,0,7,0,1,1,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,2,4,0,0,2,5,1,3,1,0,0,0,0,0,0,0,0,0,0,0,0,3,1,0,0,0,1,2,0,4,2,0,0,0,1,0,0,0,0,0,0,0,0,0,1,2,0,0,0,0,0,0,0,2,2,1,0,3,1,0,0,0,0,0,0,0,2,0,1,0,0,0,1,1,0,0,0,2,2,1,1,0,1,1,0,0,0,0,0,0,0,0,1,0,2,0,1,1,2,1,0,4,1,0,1,2,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,4,2,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,2,6,2,0,1,2,0,0,0,0,0,0,0,0,0,0,0,2,0,1,1,0,0,1,0,5,0,1,1,1,2,1,0,0,0,0,0,0,1,0,1,1,2,1,0,2,0,0,1,3,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,0,1,2,2,0,0,1,3,2,1,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,2,1,0,0,0,4,0,0,1,1,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,2,2,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,2,1,4,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,1,1,0,0,0,4,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,2,1,3,0,0,0,1,4,0,1,1,0,2,0,0,0,0,0,0,0,0,0,1,0,2,0,2,0,0,0,0,5,0,1,0,0,2,0,0,0,0,0,0,0,0,0,3,0,0,1,1,0,1,0,1,4,1,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,0,1,1,6,1,1,1,5,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,1,1,0,0,0,4,0,0,0,2,0,1,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,1,1,3,2,2,0,1,3,0,0,0,1,0,0,0,1,1,0,0,0,1,1,2,0,1,0,6,0,3,0,1,1,1,0,0,0,0,0,0,0,1,3,1,1,0,0,0,0,1,1,5,1,0,1,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,1,0,1,0,0,4,1,0,0,1,1,0,0,1,0,0,0,0,0,1,1,1,0,3,3,1,0,1,0,6,0,2,1,1,0,2,0,0,1,0,0,0,0,1,0,0,2,2,0,1,0,0,2,4,2,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,1,3,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,1,4,0,2,1,1,0,0,0,0,0,0,0,0,0,0,1,0,1,9,0,1,2,1,0,5,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,1,1,1,0,0,0,0,0,0,0,0,0,0,0)
names(cali_df)
# grab the variables that are most interesting.
cali_sub_df <- cali_df %>%
select(area,
raw_stop_counts, raw_device_counts,
stops_by_day, stops_by_each_hour,
popularity_by_hour_monday,
popularity_by_hour_tuesday,
popularity_by_hour_wednesday,
popularity_by_hour_thursday,
popularity_by_hour_friday,
popularity_by_hour_saturday,
popularity_by_hour_sunday)
View(cali_sub_df)
write_csv(x = cali_sub_df, path = "data/california_nhood_safegraph.csv")
write_csv(x = cali_sub_df, path = "data/cali_subset_nhood_safegraph.csv")
library(readr)
library(lubridate)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
?clean_names
library(janitor)
crime_june_df <- crime_df %>%
clean_names()
View(crime_june_df)
names(crime_june_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ_mdy = mdy(date_occ))
library(dplyr)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ_mdy = mdy(date_occ))
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ_mdy = mdy_hms(date_occ))
View(crime_june_df)
library(readr)
library(dplyr)
library(lubridate)
library(janitor)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ))
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ_mdy =- "June" )
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ_mdy == "June" )
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ == "June" )
library(readr)
library(dplyr)
library(lubridate)
library(janitor)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ))
View(crime_june_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ == "2020-01-08")
View(crime_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ == "2020-06")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ == "2020-06*")
View(crime_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ >= "2020-01-06" & <= "2020-30-06")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ >= "2020-01-06" & date_occ <= "2020-30-06")
library(readr)
library(dplyr)
library(lubridate)
library(janitor)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ))
View(crime_june_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ >= "2020-01-06" & date_occ <= "2020-30-06")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ > "2020-01-06" & date_occ < "2020-30-06")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ = mdy_hms(date_occ)) %>%
filter(date_occ >= "2020-06-01" & date_occ <= "2020-06-30")
View(crime_june_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ c= mdy_hms(date_occ),
date_rptd = mdy_hms(date_rptd)) %>%
filter(date_occ >= "2020-06-01" & date_occ <= "2020-06-30")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ  = mdy_hms(date_occ),
date_rptd = mdy_hms(date_rptd)) %>%
filter(date_occ >= "2020-06-01" & date_occ <= "2020-06-30")
View(crime_june_df)
write_csv(x = crime_june_df, path = "data/la_crime_june.csv")
library(readr)
library(dplyr)
library(lubridate)
library(janitor)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ  = mdy_hms(date_occ),
date_rptd = mdy_hms(date_rptd)) %>%
filter(date_occ >= "2020-06-01" & date_occ <= "2020-06-30")
write_csv(x = crime_june_df, path = "data/la_crime_june.csv")
library(readr)
library(dplyr)
library(lubridate)
library(janitor)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_occ_lub  = mdy_hms(date_occ),
date_rptd_lub = mdy_hms(date_rptd)) %>%
filter(date_occ_lub >= "2020-06-01" & date_occ_lub <= "2020-06-30")
write_csv(x = crime_june_df, path = "data/la_crime_june.csv")
View(crime_june_df)
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_rptd_lub = mdy_hms(date_rptd),
date_occ_lub  = mdy_hms(date_occ)) %>%
filter(date_occ_lub >= "2020-06-01" & date_occ_lub <= "2020-06-30")
View(crime_june_df)
library(readr)
library(dplyr)
library(lubridate)
library(janitor)
crime_df <- read_csv("data/Crime_Data_from_2020_to_Present.csv")
crime_june_df <- crime_df %>%
clean_names() %>%
mutate(date_rptd_lub = mdy_hms(date_rptd),
date_occ_lub  = mdy_hms(date_occ)) %>%
filter(date_occ_lub >= "2020-06-01" & date_occ_lub <= "2020-06-30")
write_csv(x = crime_june_df, path = "data/la_crime_june.csv")
library(tidycensus)
library(readr)
library(dplyr)
library(tidyr)
library(sf)
library(ggplot2)
library(purrr)
# safe_df <- read_csv("data/neighborhood_patterns_june_2020.gz")
# cali_df <- safe_df %>%
#   filter(region == "CA")
# write_csv(x = cali_df, path = "data/cali_nhood_safegraph.csv")
# safegraph nhood data subset for california.
cali_df <- read_csv("data/cali_nhood_safegraph.csv")
View(cali_df)
